# L5 非连续分配

## 需求背景

连续分配的缺点：
- 必须连续
- 存在外碎片和内碎片
- 动态修改困难
- 内存利用率低

非连续分配的目标：
- 允许非连续物理地址空间
- 共享代码和数据
- 支持动态加载和链接

实现需要解决的问题： 虚实地址转换（软件、硬件实现）

如何选择非连续分配的内存分块大小：
- 段式存储
- 页式存储

## 段式存储管理

进程的段地址空间由多个段组成

段表示访问方式和存储数据等属性相同的一段地址空间，对应一个连续内存块。

段访问：

逻辑地址由二元组（段号，段内偏移）组成。

以段号查询段表，得到段描述符，判断偏移是否越界，然后段基址和偏移相加得到物理地址

## 页式存储管理

把物理地址空间划分为大小相同的基本分配单位**页帧（帧）**，大小为2的幂。内存物理地址表示为（帧号，偏移）。

把逻辑地址空间划分为大小相同的基本分配单位**页面（页）**，大小和页帧相同。页内偏移=帧内偏移，但通常页号不等于帧号。

- 逻辑地址的页号是连续的
- 物理地址的帧号是不连续的

以页号查找**页表**，得到帧号。

### 页表

每个进程都有页表，每个页面对应一个页表项，随进程运行状态而动态变化。

页表基址存在页表基址寄存器（PTBR）。

页表项组成：
- 帧号
- 存在位
- 修改位
- 引用位

性能问题： 访存需要两次内存访问

页表大小问题：页表可能非常大

如何处理：
- 缓存
- 间接访问（多级页表）

### 快表

TLB使用关联存储实现，可以快速访问。

### 多级页表

