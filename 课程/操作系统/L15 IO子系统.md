# L15 IO子系统

## IO设备

三种常见类型：
- 字符设备：键盘，鼠标，串口
- 块设备：磁盘驱动器等
- 网络设备

### 字符设备

以字节为单位访问，通常使用文件操作访问。

### 块设备

均匀的数据块访问

访问：
- 原始IO或文件系统接口
- 内存映射

### 网络设备

格式化报文交换

send/receive网络接口

## IO特点

- 阻塞IO：进程等待IO
- 非阻塞IO：立即从系统调用返回，可能读写不成功
- 异步IO：读数据时，使用指针标记缓冲区，立即返回；稍后OS填充缓冲区并通知用户；写数据时同理

## IO结构

- 北桥：连接高速设备；
- 南桥：连接低速设备；

设备控制器：CPU和IO设备的接口

CPU与设备的通信方式
- 轮询
- 设备中断
- DMA

IO指令：通过IO端口号访问设备寄存器

内存映射IO：设备的寄存器/存储被映射到内存物理地址中。

## 数据传输

传输机制：
- 程序控制IO：用in/out或load/store传输。硬件简单，但是消耗CPU时间
- 直接内存访问DMA：设备控制器直接访问系统总线

设备通知OS的机制：
- 轮询：定期检查IO设备的状态寄存器
- 设备中断

## 磁盘调度

磁盘读取中的机械延迟：
- 寻道时间：最耗时
- 旋转延迟：平均是旋转一周的时间的一半
- 数据读取时间

磁盘调度算法优化磁盘访问顺序来提高磁盘访问性能

### FIFO

按顺序处理请求

性能差

### 最短服务时间优先SSTF

依据当前的磁头位置，总是选择寻道时间最短的操作

### 扫描算法SCAN

在一个方向上移动，访问所有未完成的请求，直到到达最后的磁道，然后调换方向

### 循环扫描算法CSCAN

当最后一个磁道被访问后，磁臂返回到磁盘的另一端再次进行

即只有一个方向移动时访问数据

### LOOK

磁臂保持移动到该方向最后一个请求，并顺序读取数据，然后折返

### CLOOK算法

只有一个方向上移动时访问数据的LOOK算法。

### N步扫描算法

将磁盘请求队列分成长度为N的子队列 用FIFO依次处理所有子队列 队列之间用扫描算法

特例:FSCAN双队列扫描（分成两个队列，交替用扫描算法处理队列，新的IO请求放在另一/空闲队列里）