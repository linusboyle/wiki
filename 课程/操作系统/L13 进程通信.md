# L13 进程通信 IPC

IPC提供两个基本操作
- 发送操作
- 接受操作

通信流程：
1. 建立通信链路
2. 通过基本操作交换信息

## 通信概念

### 间接通信

通过内核支持，将消息放到内核的消息队列里。此时某个进程可能已经结束。基本操作指定的目标是消息队列。

每个消息队列有一个惟一的标识。只有共享了相同消息队列的进程才能够通信。

通信链路的属性
- 只有共享了相同消息队列的进程,才建立连接
- 连接可以是单向或双向
- 消息队列可以与多个进程相关联
- 每对进程可以共享多个消息队列

#### 消息队列

每个消息是一个字节序列。相同标识的消息按照FIFO组成队列。

相关sysccall：
- msgget 获取标识
- msgsnd
- msrcv，
- msgctl 控制消息队列

### 直接通信

在进程间直接进行交流。 此时两个进程必须都存在， 且基本操作必须指定目标进程。

直接通信的通信链路的属性
- 自动建立链路
- 一条链路恰好对应一对通信进程
- 每对进程之间只有一个链接存在
- 链接可以是单向的,但通常为双向的

### 阻塞与非阻塞通信

- 阻塞通信
    - 阻塞发送：发送者发送后等待直到消息被接收
    - 阻塞接收：接收者在请求接收消息后进入等待，直到成功接收
- 非阻塞通信

### 通信链路缓冲

- 0容量：发送方必须等待接收方
- 有限容量：缓冲队列满时，发送方必须等待
- 无限容量：不需要等待

## 信号和管道

### 信号

**信号**：进程间软件中断通知和处理机制

信号的处理：
- 捕获：执行用户处理函数
- 忽略：执行OS的缺省处理
- 屏蔽：禁止接收和处理信号

不足：信息量小，只有信号类型

#### linux信号机制

信号产生后，操作系统更改用户栈，执行处理例程。进程处理例程返回时，执行sigreturn系统调用，而非直接返回原处执行。

因此，在用户**栈中**存放了一段跳板代码。

### 管道

进程间基于内存文件的通信机制。

子进程从父进程继承文件描述符。默认：stdin,stdout,stderr

## 共享内存

把同一个物理内存区域映射到多个进程的内存地址空间的通信机制。

进程间的内存地址需要明确设置共享内存段，同一进程的线程总是共享相同的内存地址空间

优点：快速、方便地共享数据

不足：必须用额外的同步机制协调数据访问